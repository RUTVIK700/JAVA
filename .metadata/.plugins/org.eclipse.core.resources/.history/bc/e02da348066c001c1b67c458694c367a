package com.prepare;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;

import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebInitParam;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class CreateUserservlet
 */
@WebServlet(urlPatterns="/addServlet",initParams= {@WebInitParam(name="dburl",value="jdbc:mysql://localhost/mydb"),
		@WebInitParam(name="dbuser",value="userdb"),@WebInitParam(name="dbPassword",value="Rutvik@1234")})
public class CreateUserservlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
     private Connection connection;
	public void init(ServletConfig config) {
		try {
			Class.forName("com.mysql.jdbc.Driver");
			connection=DriverManager.getConnection(config.getInitParameter("dburl"),config.getInitParameter("dbuser"),config.getInitParameter("dbPassword"));
		} catch (SQLException e) {
			e.printStackTrace();
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}
	}



	protected void doPost(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
		String f = req.getParameter("firstName");
		String l = req.getParameter("lastName");
		String e = req.getParameter("email");
		String p = req.getParameter("password");
		try {
			Statement statement = connection.createStatement();
			int result = statement.executeUpdate("insert into user values('"+f+"','"+l+"','"+e+"','"+p+"')");
			PrintWriter out = res.getWriter();
			if(result>0) {
				out.print("<h1>USER CREATED </h1>");	
			}
			else {
				out.print("<h1>FAILED TO CREATE</h1>");
			}
		} catch (SQLException e1) {
			e1.printStackTrace();
		}
	}
	
	
	public void destroy() {
		try {
			connection.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

}
